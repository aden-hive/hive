name: Issue Triage

on:
  issues:
    types: [opened]

jobs:
  triage:
    if: >
      !contains(github.event.issue.body, 'generated by') &&
      !startsWith(github.event.issue.title, 'Auto-generated')

    runs-on: ubuntu-latest
    timeout-minutes: 5

    permissions:
      issues: write

    steps:
      - name: Add welcome comment
        uses: actions/github-script@v6
        with:
          script: |
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: "Thank you for opening this issue! We'll review it soon."
            });

      - name: Add labels
        uses: actions/github-script@v6
        with:
          script: |
            const { title, body } = context.payload.issue;
            const labels = ['triage'];

            if (
              title.toLowerCase().includes('bug') ||
              title.toLowerCase().includes('error')
            ) {
              labels.push('bug');
            }

            if (
              title.toLowerCase().includes('doc') ||
              (body && body.toLowerCase().includes('doc'))
            ) {
              labels.push('documentation');
            }

            await github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels
            });
