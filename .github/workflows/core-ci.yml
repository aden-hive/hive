name: Core Framework CI

on:
  push:
    branches: [ "main", "master" ]
    paths:
      - 'core/**'
      - '.github/workflows/core-ci.yml'
  pull_request:
    branches: [ "main", "master" ]
    paths:
      - 'core/**'

jobs:
  quality-gate:
    name: Core Quality & Security
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./core    # CRITICAL: Execute all commands inside 'core' folder

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"     # Matches common AI standards
          cache: 'pip'               # Caches dependencies for speed

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ruff bandit pytest
          
          # Install project requirements if they exist
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f requirements-dev.txt ]; then pip install -r requirements-dev.txt; fi
          
          # Install the package itself in editable mode
          pip install -e .

      - name: Linting (Ruff)
        # Checks for syntax errors and style issues
        run: ruff check . --output-format=github
        continue-on-error: true      # Important: Won't block merge if existing code is messy

      - name: Security Audit (Bandit)
        # Scans for security vulnerabilities (e.g., hardcoded passwords)
        run: bandit -r . -ll
        continue-on-error: true

      - name: Run Tests
        # Runs the unit tests found in core/tests
        run: pytest
